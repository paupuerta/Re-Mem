# Development Dockerfile with cargo-watch for hot-reload
FROM rust:1.93

RUN cargo install cargo-watch

WORKDIR /app

# Pre-copy manifests to cache dependencies
COPY Cargo.toml Cargo.lock* ./

# Create a dummy src to build dependencies first (layer caching)
RUN mkdir src && echo "fn main() {}" > src/main.rs && cargo build && rm -rf src

# Source code will be mounted as a volume at runtime
EXPOSE 3000

ENV RUST_LOG=info

CMD ["cargo", "watch", "-x", "run"]
